# Outlier Data Management System

실험 및 생산 데이터의 이상치 자동 검출·제거, 통계 분석, 시각화 및 비교 분석을 위한 종합적인 웹 애플리케이션입니다.

## 주요 기능

### 🔍 **이상치 검출 및 제거**
- **3가지 이상치 검출 방법**:
  - Z-Score (표준편차 기반)
  - IQR (사분위수 기반) 
  - MAD (중앙절대편차 기반)
- **동적 임계값 조정**: 실시간 슬라이더로 임계값 조정 가능
- **실시간 통계 계산**: 평균, 표준편차, 중앙값 등 자동 계산

### 📊 **데이터 관리**
- **다중 입력 방식**: 직접 입력, Excel/CSV 파일 업로드
- **유연한 데이터 구조**: 동적 행/컬럼 추가, 사용자 정의 측정 항목
- **멀티 샘플 관리**: 샘플명, 생산일자, 패스 수(회차) 추적
- **데이터셋 저장/불러오기**: 세션 기반 데이터 관리

### 📈 **시각화 및 분석**
- **인터랙티브 차트**: Plotly 기반 산점도 및 이상치 표시
- **패스별 트렌드 분석**: Size/PI 값의 패스별 변화 추이 및 상관관계 분석
- **사용자 정의 필드 상관관계 분석**: Size(nm) vs 사용자 정의 필드 상관관계 시각화
- **점도 호환 모드**: 점도 데이터 입력 시 기준값(UHV, HV, LV)과 비교 분석
- **데이터셋 비교**: 여러 데이터셋 간 통계 비교 분석
- **종합 대시보드**: 원본/필터링 데이터 동시 표시

### 🎨 **사용자 인터페이스**
- **완전한 다크모드**: 라이트/다크 테마 자유 전환 및 모든 섹션 최적화
- **설정 자동 저장**: 테마 설정 로컬 스토리지 저장 및 다음 방문 시 유지
- **우수한 시인성**: 데이터셋 관리, 임계값 설정, 패스별 관리 섹션 다크모드 전용 스타일
- **접근성 향상**: 높은 대비율로 눈의 피로 감소 및 다양한 환경 지원
- **시각적 일관성**: 다크모드에서도 라이트모드와 동일한 시각적 계층 유지
- **반응형 디자인**: 모든 화면 크기에서 일관된 사용자 경험

### 💾 **데이터 다운로드 및 업로드**
- **📊 원클릭 다운로드**: 클릭 한 번으로 즉시 CSV 다운로드
- **결과 다운로드**: 이상치 제거 후 분석 결과 CSV
- **🧠 스마트 업로드**: 어떤 형식이든 자동 파싱하여 데이터만 추출
- **🔄 완벽한 워크플로우**: 다운로드 → 편집 → 업로드 무제한 반복
- **✨ 초간단 UX**: 복잡한 옵션 선택 없이 바로 사용

## 사용 방법

### 1. 기본 정보 입력
1. **샘플명**: 분석할 샘플의 이름을 입력하세요
2. **생산일자**: 샘플의 생산 또는 실험 날짜를 선택하세요
3. **패스 수(회차)**: 동일 샘플에 대한 측정 회차를 입력하세요 (1차, 2차, 3차...)
   - 예: 같은 샘플을 3번 측정한 경우 각각 1, 2, 3으로 구분

### 2. 데이터 입력 방법
#### 📝 **직접 입력**
- 테이블의 각 셀에 직접 숫자 데이터를 입력
- **컬럼 순서**: No. → Size(nm) → PI → 기타 컬럼들 (고정 순서 적용)
- **행 추가**: 새로운 데이터 행 추가
- **컬럼 추가**: 사용자 정의 측정 항목 추가 (예: 온도, 압력 등)

#### 📁 **파일 업로드**
- 지원 형식: Excel (.xlsx, .xls), CSV (.csv)
- 자동 컬럼 매핑: size, nm, PI 등의 컬럼 자동 인식
- 기타 숫자 컬럼도 자동으로 가져오기
- **스마트 CSV 파싱**: 메타데이터가 포함된 CSV 파일도 자동으로 데이터 부분만 추출

#### 📤 **테이블 다운로드**
- **원클릭 다운로드**: 버튼 클릭 즉시 CSV 파일 다운로드
- **자동 파일명**: `table_data_샘플명_날짜시간.csv` 형식으로 생성
- **편집 친화적**: Excel/메모장에서 수정 후 재업로드 완벽 지원
- **🧠 스마트 업로드**: 어떤 형식도 자동으로 데이터 부분만 추출

### 3. 데이터셋 관리
#### 💾 **저장 및 불러오기**
- **데이터셋 저장**: 현재 작업 중인 데이터를 이름을 지정하여 저장
- **데이터셋 불러오기**: 드롭다운에서 저장된 데이터셋 선택 후 불러오기
- **데이터셋 삭제**: 불필요한 저장된 데이터셋 삭제
- **저장된 개수 표시**: 현재 저장된 데이터셋 개수 실시간 표시

#### 📊 **데이터셋 비교**
- **비교 분석**: 여러 저장된 데이터셋 간 통계 비교
- **시각화**: 데이터셋별 차이점을 차트로 표시
- **통계 요약**: 각 데이터셋의 평균, 표준편차 등 비교 테이블

### 4. 이상치 검출 임계값 설정 및 계산
1. **임계값 조정**: 각 방법별 슬라이더로 임계값을 실시간 조정
   - Z-Score: 1.0 ~ 5.0 (권장: 2.0~3.0)
   - IQR: 0.5 ~ 3.0 (권장: 1.5~2.0)
   - MAD: 1.0 ~ 5.0 (권장: 3.0~4.0)

2. **이상치 검출 및 계산**: 버튼 클릭으로 3가지 방법 동시 실행
3. **결과 확인**: 원본 데이터, 필터링 데이터, 통계 결과, 시각화 차트 표시

### 5. 패스별 평균값 관리
1. **평균값 입력**:
   - **수동 입력**: 패스 번호, Size(nm) 평균, PI 평균을 직접 입력
   - **계산 결과 활용**: 이상치 검출 결과에서 "계산 결과에서 평균값 추가" 버튼 클릭
   - **사용자 정의 필드**: 필드명을 자유롭게 설정하여 점도, 온도, 압력 등 다양한 데이터 저장

2. **사용자 정의 필드 설정**:
   - **필드명 변경**: 기본 "사용자 입력 필드(레퍼런스)"를 원하는 이름으로 변경
   - **시각적 강조**: 오렌지 그라데이션 배경, 점선 테두리, 펄스 애니메이션으로 편집 가능성 강조
   - **직관적 안내**: "👈 클릭하여 편집" 텍스트와 툴팁으로 사용법 안내
   - **데이터 종류**: 점도(cP), 온도(℃), 압력(bar), 농도(%) 등 어떤 데이터든 가능
   - **플레이스홀더**: 입력 값은 항상 "레퍼런스값"으로 표시
   - **동적 UI**: 필드명 변경 시 테이블 헤더와 버튼 텍스트 자동 업데이트

3. **트렌드 분석**:
   - **패스별 트렌드**: Size/PI 값의 패스별 변화 추이 시각화
   - **상관관계 분석**: Size-PI 간 상관계수 계산 및 시각화
   - **통계 요약**: 평균, 표준편차, 변동계수 등 종합 통계

4. **사용자 정의 필드 상관관계 분석**:
   - **조건**: 사용자 정의 데이터 2개 이상 필요
   - **시각화**: Size(nm) vs 사용자 정의 필드 산점도 차트
   - **점도 호환**: 필드명에 "점도" 또는 "viscosity" 포함 시 UHV, HV, LV 기준값과 비교
   - **상관계수**: Size-사용자 정의 필드 간 상관관계 수치 제공

### 6. 결과 해석 및 내보내기

#### 📊 **결과 화면 구성**
- **원본 데이터 통계**: 필터링 전 전체 데이터 통계
- **필터링 데이터 통계**: 이상치 제거 후 데이터 통계
- **이상치 정보**: 각 방법별 제거된 이상치 개수 및 비율
- **시각화 차트**: 원본 데이터와 이상치가 표시된 산점도

#### 🔍 **이상치 검출 방법별 특징**
- **Z-Score 방법**: 표준편차를 기준으로 이상치 제거 (정규분포 가정)
- **IQR 방법**: 사분위수 범위를 기준으로 이상치 제거 (분포 독립적)
- **MAD 방법**: 중앙절대편차를 기준으로 이상치 제거 (로버스트 통계)

#### 💾 **결과 다운로드**
- **CSV 파일**: 원본/필터링 데이터, 통계 결과, 메타데이터 포함
- **파일 구성**: 
  - 샘플 정보 (샘플명, 생산일자, 패스 수)
  - 원본 데이터 및 통계
  - 각 방법별 필터링 결과 및 통계
  - 이상치 제거 정보

## 기술 스택

- **Backend**: Flask (Python 3.12)
- **Frontend**: 
  - HTML5, Tailwind CSS, JavaScript (ES6+)
  - 모듈화된 아키텍처: 5개 JavaScript 모듈
  - Jinja2 템플릿 상속 시스템
  - 반응형 Glass UI 디자인
- **데이터 처리**: Pandas, NumPy, SciPy
- **시각화**: Plotly, Matplotlib, Seaborn
- **통계 분석**: 상관계수, 트렌드 분석, 변동계수 계산
- **파일 처리**: OpenPyXL, XlsxWriter
- **배포**: Azure Web App

## 로컬 실행

```bash
# 의존성 설치
pip install -r requirements.txt

# 개발 서버 실행
python app.py

# 브라우저에서 http://localhost:8000 접속
```

## Azure 배포

```bash
# Azure CLI 로그인
az login

# 웹앱 생성
az webapp create --resource-group <resource-group> --plan <app-service-plan> --name <app-name> --runtime "PYTHON|3.12"

# 코드 배포
az webapp deployment source config-zip --resource-group <resource-group> --name <app-name> --src <zip-file>
```

## 파일 구조

```
outlier-webapp/
├── app.py                    # Flask 애플리케이션 (캐시 제어 및 정적 파일 최적화)
├── requirements.txt          # Python 의존성
├── startup.sh               # Azure 시작 스크립트
├── web.config               # Azure 배포 설정
├── test_modules.html        # 모듈 테스트 페이지
├── static/                  # 정적 파일 (모듈화된 구조)
│   ├── css/
│   │   └── main.css        # 커스텀 스타일 (Glass UI, 애니메이션, 반응형)
│   └── js/                 # JavaScript 모듈
│       ├── utils.js        # 유틸리티 함수 및 사용자 정의 필드 관리
│       ├── data-manager.js # 데이터 입력 및 테이블 관리
│       ├── chart-handler.js # 차트 생성 및 이상치 검출 계산
│       ├── pass-manager.js # 패스별 평균값 관리 및 트렌드 분석
│       └── main.js         # 앱 초기화 및 모듈 간 조정
├── templates/               # Jinja2 템플릿 (템플릿 상속 구조)
│   ├── base.html           # 베이스 템플릿 (리소스 로딩, 메타태그)
│   ├── index.html          # 메인 페이지 (모듈화된 구조)
│   ├── index_original.html # 원본 템플릿 백업
│   └── components/         # 재사용 가능한 컴포넌트
│       └── help_modal.html # 도움말 모달
└── README.md               # 사용 설명서
```

## 주요 특징

### 🧪 **고급 분석 기능**
- **패스별 트렌드 분석**: 연속 공정에서 패스별 품질 변화 추적
- **실험군/대조군 비교 분석**: 동일 패스에 대한 실험군과 대조군 데이터 비교
- **사용자 정의 필드 상관관계 분석**: 입자 크기와 사용자 정의 변수 간 상관관계 시각화
- **그룹별 시각화**: 실험군(파란색)과 대조군(초록색) 구분 표시
- **유연한 필드 관리**: 점도, 온도, 압력 등 다양한 측정 항목 지원
- **점도 호환 모드**: 점도 데이터 시 UHV, HV, LV 기준값 대비 생산 데이터 위치 분석
- **다중 인자 통계**: 상관계수, 트렌드, 변동계수 종합 분석

### 🚀 **성능 최적화**
- **모듈화된 아키텍처**: 1754라인 단일 파일을 5개 JavaScript 모듈로 분할
- **템플릿 상속**: Jinja2 베이스 템플릿으로 코드 재사용성 향상
- **캐시 최적화**: 정적 파일 장기 캐싱, 동적 컨텐츠 캐시 방지
- **브라우저 호환성**: 캐시 무효화를 통한 업데이트 즉시 반영
- **세션 기반 데이터 관리**: 데이터베이스 불필요
- **실시간 임계값 조정**: 즉시 반영 및 시각화
- **경량화된 프론트엔드**: CDN 기반 라이브러리 활용

### 🎨 **사용자 인터페이스**
- **완전한 다크모드 지원**: 50여 개 색상 클래스 다크모드 전용 스타일 적용
- **시각적 계층 유지**: 다크모드에서도 라이트모드와 동일한 시각적 구분
- **우수한 시인성**: 데이터셋 관리, 임계값 설정, 패스별 관리 섹션 최적화
- **직관적 디자인**: 사용자 정의 필드 편집 가능성을 시각적으로 강조
- **실시간 피드백**: 호버, 포커스, 애니메이션 효과로 상호작용 안내
- **접근성 개선**: 툴팁, 안내 텍스트, 방향성 아이콘으로 사용법 명확화
- **반응형 레이아웃**: 모든 화면 크기에서 일관된 사용자 경험

### 🔒 **데이터 보안**
- 클라이언트 측 데이터 처리 (서버 저장 없음)
- 세션 기반 임시 저장 (브라우저 종료 시 자동 삭제)
- 파일 업로드 검증 및 크기 제한 (16MB)

### 🌐 **배포 최적화**
- Azure Web App Free Tier 호환
- 데이터베이스 의존성 없음
- 확장 가능한 아키텍처

## 사용 제한 및 권장사항

### ⚠️ **사용 제한**
1. **데이터 형식**: 모든 측정값은 숫자여야 함
2. **최소 데이터**: 통계 계산을 위해 최소 3개 이상의 유효한 데이터 필요
3. **세션 유지**: 브라우저 종료 시 데이터 자동 삭제
4. **파일 크기**: 업로드 파일 최대 16MB

### 💡 **권장사항**
- 중요한 데이터는 CSV 다운로드를 통해 별도 백업
- 임계값 조정 시 도메인 전문 지식 활용
- 여러 방법의 결과를 종합적으로 비교 분석
- 데이터셋 비교 기능을 통한 재현성 검증

## 문제 해결

### 🔧 **일반적인 문제**
- **계산 오류**: 빈 값이나 문자 데이터 확인, 최소 데이터 개수 확인
- **파일 업로드 실패**: 파일 형식 및 크기 확인, 컬럼명 매핑 확인
- **차트 표시 오류**: JavaScript 활성화 확인, 브라우저 호환성 확인

### 🔄 **페이지 로딩 및 캐시 문제**
1. **🔒 시크릿 모드(게스트 모드) 사용** (가장 확실한 방법):
   - **Chrome/Edge**: Ctrl + Shift + N
   - **Firefox**: Ctrl + Shift + P  
   - **Safari**: Cmd + Shift + N
   - 브라우저 캐시를 완전히 무시하여 항상 최신 버전 로드
   - ⚠️ 주의: 시크릿 모드에서는 저장된 데이터셋 접근 불가

2. **🔄 새로고침 버튼 사용**:
   - 화면 상단 우측의 "🔄 새로고침" 버튼 클릭
   - 페이지가 완전히 새로 로드되면서 모든 캐시 정리
   - 일반적인 기능 오류나 화면 문제 해결

3. **🌙 다크모드 기능**:
   - 화면 상단 좌측의 "🌙/☀️ 다크모드" 토글 버튼 클릭
   - 다크모드와 라이트모드 자유 전환
   - 설정 자동 저장으로 다음 방문 시에도 유지
   - 어두운 환경에서 눈의 피로 감소
   - 모든 섹션 다크모드 전용 스타일 적용으로 우수한 시인성 제공

4. **💡 캐시 문제가 발생하는 이유**:
   - 브라우저가 웹사이트 속도 향상을 위해 파일들을 임시 저장(캐시)
   - 웹사이트 업데이트 시 이전 버전이 계속 사용되어 문제 발생
   - 시크릿 모드나 새로고침 버튼은 이러한 캐시를 무효화

### 📞 **지원 및 도움말**
- 애플리케이션 내 도움말 모달 참조 (문제 해결 방법 포함)
- 각 기능별 상세 사용법 및 예제 제공
- GitHub Issues 활용

## 버전 정보

- **현재 버전**: 2.6.0
- **최종 업데이트**: 2025-07-11
- **주요 업데이트**:
  - **📤 완벽한 CSV 다운로드/업로드 시스템 (v2.6.0)**:
    - **다운로드 옵션 모달**: "데이터만" vs "메타데이터 포함" 선택 가능
    - **스마트 업로드 파싱**: 메타데이터가 포함된 CSV 파일도 자동으로 데이터 부분만 추출
    - **다운로드-편집-업로드 사이클**: Excel에서 편집 후 재업로드 완벽 지원
    - **누락 API 엔드포인트 추가**: `/get_saved_datasets`, `/delete_dataset` 구현
    - **데이터셋 관리 기능 복원**: 저장/불러오기/삭제 기능 정상 동작
    - **Size(nm) 열명 통일**: 모든 참조를 `Size(nm)`으로 통일하여 계산 오류 해결
    - **도움말 모달 업데이트**: 최신 다운로드/업로드 기능 사용법 추가
  - **🌙 다크모드 시인성 대폭 개선 (v2.5.3)**:
    - **데이터셋 관리 섹션**: 모든 컬러 배경 및 텍스트 색상 다크모드 최적화
    - **이상치 검출 임계값 설정**: 슬라이더 트랙, 썸, 그림자 효과 다크모드 전용 스타일 적용
    - **패스별 평균값 관리**: 사용자 정의 필드 하이라이트 및 텍스트 색상 다크모드 대응
    - **완전한 색상 매핑**: 50여 개 색상 클래스 다크모드 전용 스타일 추가
    - **시각적 계층 유지**: 다크모드에서도 라이트모드와 동일한 시각적 구분 제공
    - **접근성 향상**: 높은 대비율로 모든 환경에서 우수한 가독성 확보
  - **🌙 다크모드 및 UI 개선 (v2.5.2)**:
    - **다크모드 기능**: 라이트/다크 테마 자유 전환 토글 버튼 추가
    - **로컬 스토리지 저장**: 테마 설정 자동 저장 및 다음 방문 시 유지
    - **데이터 테이블 가독성 향상**: 입력 필드 글자색 및 배경색 명확화
    - **완전한 다크모드 지원**: 모든 UI 요소 (카드, 테이블, 입력 필드, 버튼) 다크모드 스타일 적용
    - **부드러운 전환 애니메이션**: 태양/달 아이콘 포함 슬라이더 스타일 토글 버튼
    - **도움말 및 문서 업데이트**: 다크모드 사용법 및 접근성 향상 정보 추가
  - **🔄 브라우저 캐시 문제 해결 (v2.5.1)**:
    - **새로고침 버튼**: 헤더에 "🔄 새로고침" 버튼 추가로 사용자 친화적 캐시 클리어
    - **강제 새로고침**: `location.reload(true)` 사용하여 모든 캐시 무시하고 페이지 재로드
    - **시각적 피드백**: 클릭 시 로딩 애니메이션 및 "새로고침 중..." 텍스트 표시
    - **문제 해결 가이드**: 도움말 모달에 단계별 문제 해결 방법 추가
    - **시크릿 모드 안내**: 새로고침으로도 해결 안 될 때 시크릿 모드 사용법 안내
    - **사용자 교육**: 캐시 문제 발생 이유 및 해결 원리 설명
  - **🔬 실험군/대조군 구분 기능 (v2.5.0)**:
    - **그룹 관리**: 패스별 평균값 입력 시 실험군/대조군 구분 선택 기능
    - **데이터 구조**: 동일 패스에 대해 실험군과 대조군 데이터 별도 관리
    - **시각적 구분**: 테이블에서 그룹별 색상 뱃지 표시 (실험군: 파란색, 대조군: 초록색)
    - **통합 시각화**: 상관관계 분석에서 실험군/대조군 데이터 구분 표시
    - **사용자 정의 필드**: 두 그룹 모두 Size(nm), PI, 사용자 정의 필드 동일 구조
    - **도움말 업데이트**: 실험군/대조군 관리 가이드 및 사용법 추가
  - **🔄 UI 섹션 순서 최적화 (v2.4.1)**:
    - **섹션 재배치**: 사용자 워크플로우에 맞는 논리적 순서로 조정
    - **올바른 순서**: 데이터 입력 → 데이터셋 관리 → 이상치 검출 → 패스별 관리
    - **테이블 컬럼 순서 고정**: No. → Size(nm) → PI → 기타 컬럼들 (동적 생성 시에도 일관성 유지)
    - **데이터셋 관리 기능 복원**: 저장, 불러오기, 삭제, 비교 분석 기능 UI 추가
  - **🏗️ 아키텍처 대규모 리팩토링 (v2.4.0)**:
    - **모듈화**: 1754라인 단일 파일을 5개 JavaScript 모듈로 분할
    - **템플릿 상속**: Jinja2 베이스 템플릿 시스템 도입
    - **정적 파일 최적화**: CSS/JS 파일 분리 및 캐시 제어 개선
    - **성능 향상**: 브라우저 캐싱 이슈 해결 및 로딩 속도 최적화
    - **코드 유지보수성**: 모듈별 책임 분리 및 재사용성 향상
  - **🎯 사용자 정의 필드 시스템**: 기존 고정 점도 필드를 유연한 사용자 정의 필드로 확장
    - 필드명 직접 편집 기능 (점도, 온도, 압력 등 자유 설정)
    - 동적 UI 업데이트 (테이블 헤더, 버튼 텍스트 자동 변경)
    - 기본값: "사용자 입력 필드(레퍼런스)", 플레이스홀더: "레퍼런스값"
    - 점도 호환 모드: 필드명에 "점도" 포함 시 기준값 비교 차트 표시
  - **🎨 UI/UX 혁신**: 사용자 정의 필드 편집 가능성 시각화
    - 오렌지 그라데이션 배경 (orange-50 to yellow-50)
    - 점선 테두리 (border-dashed border-orange-400)
    - 펄스 애니메이션 포인트 (우측 상단 orange-500 점)
    - 직관적 안내 텍스트: "👈 클릭하여 편집"
    - 툴팁 및 호버 효과로 사용자 경험 개선
  - **📐 레이아웃 최적화**: 행 정렬 개선 및 시각적 흐름 향상
  - **🔄 API 개선**: `/get_custom_data_correlation` 엔드포인트로 통합
  - **📖 도움말 업데이트**: 사용자 정의 필드 관리 가이드 추가
  - **UI/UX 개선**: 모든 모달 디자인 통일화 (helpModal 스타일 적용)
    - 그라데이션 배경 및 둥근 모서리 적용
    - 향상된 닫기 버튼 디자인 (빨간색 원형 X 버튼)
    - 백드롭 블러 효과 및 투명도 개선
    - 반응형 디자인 최적화
  - **평균값 입력 폼 개선**: 라벨 텍스트 가운데 정렬
  - **패스별 평균값 관리 시스템**: 패스별 Size/PI 평균값 저장 및 관리
  - **트렌드 분석 기능**: Size/PI 값의 패스별 변화 추이 시각화
  - **draw_plot.py 스타일 시각화**: 기준값 대비 생산 데이터 비교 차트
  - 동적 임계값 조정 기능 추가
  - Plotly 기반 인터랙티브 시각화 구현
  - 다중 데이터셋 관리 및 비교 기능 추가
  - Tailwind CSS 기반 UI 리디자인
  - 파일 업로드/다운로드 기능 강화

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.